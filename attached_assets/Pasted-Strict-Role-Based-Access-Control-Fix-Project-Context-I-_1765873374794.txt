Strict Role-Based Access Control Fix
ğŸ”¹ Project Context

I have an existing software project with:

Booking calendar

Masters

Operations

Reports

User Management & User Rights

UI and core flows are already implemented and must NOT be redesigned.

Your task is to fix permission enforcement bugs so that users only see and access exactly what the admin allows.

â— Current Problem (From Uploaded Images)

Example user: pk (Custom Role)

Admin has configured:

Masters

Customer Master â†’ View only

Room Master â†’ Create only

No permission given for:

Reports

Booking dashboard

Other Masters

Edit/Delete anywhere

âŒ Actual Behavior (Bug)

pk user:

Can access Reports section fully

Can see Booking Calendar dashboard

Has extra permissions not granted

View/Create/Edit/Delete rules are NOT enforced properly

ğŸ¯ Expected Behavior (Must Be Implemented)
âœ… 1. Module-Level Access (Strict)

If a user does NOT have view permission for a module:

Module must be hidden from sidebar

Direct URL access must be blocked (403)

Example:

If Reports â†’ view = false
â†’ Reports menu must NOT appear
â†’ /reports/* APIs must reject access

âœ… 2. Action-Level Access (Strict)

Each module must obey View / Create / Edit / Delete independently.

Examples:

Customer Master:

View = âœ… â†’ list visible

Create/Edit/Delete = âŒ â†’ buttons hidden + API blocked

Room Master:

Create = âœ…

View/Edit/Delete = âŒ

Only â€œAdd Roomâ€ allowed

No list, no edit, no delete

âœ… 3. Booking Dashboard Access Control

Booking Calendar must be visible ONLY if:

Booking â†’ View permission = true

Otherwise:

Dashboard must be hidden

API routes blocked

âœ… 4. Reports Section Fix

Reports must follow permissions strictly:

Conflict Report

Booking Report

Editor Report

Chalan Report

Each report:

Visible only if view = true

No report should be visible by default

ğŸ” Permission System Rules (VERY IMPORTANT)

NO hard-coded permissions

gst / nongst / custom must behave the same

All permissions come from User Rights table

Single Source of Truth

Permissions stored in DB

Used by:

Sidebar rendering

Button visibility

Backend API authorization

Backend Enforcement (Mandatory)

Even if UI hides buttons:

APIs must still validate permissions

Return proper 403 Forbidden if access is denied

ğŸ§  Implementation Requirements
Frontend

Build a centralized permission helper:

canView(module)

canCreate(module)

canEdit(module)

canDelete(module)

Use it for:

Sidebar menu rendering

Button visibility

Page access guards

Backend

Add middleware like:

checkPermission(module, action)


Apply it to:

All CRUD APIs

Reports APIs

Booking APIs

ğŸ§ª Test Scenarios (Must Pass)

Custom user with:

Customer Master â†’ View only

Room Master â†’ Create only

No Report permissions

âœ… Expected:

Sidebar shows:

Customer Master

Room Master

Reports NOT visible

Booking dashboard NOT visible

No Edit/Delete anywhere

Direct API calls without permission â†’ blocked

âš ï¸ Constraints

âŒ Do NOT redesign UI

âŒ Do NOT change database type

âŒ Do NOT break existing flows

âœ… Fix logic only